%
% Copyright © 2016 Peeter Joot.  All Rights Reserved.
% Licenced as described in the file LICENSE under the root directory of this GIT repository.
%
\makeproblem{One dimensional photonic crystal.}{emt:problemSet8:3}{ 

Consider an infinitely periodic one dimensional photonic crystal (1DPC) shown in \cref{fig:ps8:ps8Fig3} below
where \( n_i \)
and
\( n_j \)
are the indices of refractions (in general complex) associated with the regions \( i \)
and \( j \) having thicknesses \( d_i \) and \( d_j \). The one period transfer matrix \( \BM \) relates the fields according to

\begin{subequations}
\label{eqn:emtproblemSet8Problem3:120}
\begin{dmath}\label{eqn:emtproblemSet8Problem3:20}
\begin{bmatrix}
E_{l,i}' \\
E_{r,i}'
\end{bmatrix}
=
\BM
\begin{bmatrix}
E_{l,i+1}' \\
E_{r,i+1}'
\end{bmatrix}
\end{dmath}
\begin{dmath}\label{eqn:emtproblemSet8Problem3:40}
\BM =
g
\begin{bmatrix}
a & b \\
\hat{b} & \hat{a}
\end{bmatrix}
\end{dmath}
\begin{dmath}\label{eqn:emtproblemSet8Problem3:60}
g = \inv{1 - \rho_{i,j}^2},
\end{dmath}
\end{subequations}

and \( \rho_{i,j} \) is the Fresnel coefficient.  Give the expressions for \( a, \hat{a}, b, \hat{b} \) in terms of \( \beta_i \), \(\beta_j\), and \( \rho_{i,j} \) where 
the phase constants in regions \( i \) and \( j \) are

\begin{subequations}
\label{eqn:emtproblemSet8Problem3:140}
\begin{dmath}\label{eqn:emtproblemSet8Problem3:80}
\beta_i = \frac{\omega}{c} n_i d_i \cos\theta_i
\end{dmath}
\begin{dmath}\label{eqn:emtproblemSet8Problem3:100}
\beta_j = \frac{\omega}{c} n_j d_j \cos\theta_j,
\end{dmath}
\end{subequations}

and \( \theta_i \) or \( \theta_j \) are the incident angles.  

%\makesubproblem{}{emt:problemSet8:3a}
\imageFigure{../../figures/ece1228-emt/ps8Fig3}{1DPC photonic crystal.}{fig:ps8:ps8Fig3}{0.3}
} % makeproblem

\makeanswer{emt:problemSet8:3}{ 

The fields inside and outside the slab are sketched in \cref{fig:1DPC:1DPCFig1}.  The wave amplitudes that we are interested in relating are

\begin{dmath}\label{eqn:emtproblemSet8Problem3:160}
\begin{aligned}
E'_{l,i} &= A \\
E'_{r,i} &= B \\
E'_{l,i+1} &= E \gamma' \\
E'_{r,i+1} &= F /\gamma',
\end{aligned}
\end{dmath}

\imageFigure{../../figures/ece1228-emt/1DPCFig1}{Fields inside and outside of a slab.}{fig:1DPC:1DPCFig1}{0.4}
where
\begin{dmath}\label{eqn:emtproblemSet8Problem3:180}
\gamma' = e^{ j \beta_{i+1} d_{i+1} }.
\end{dmath}

Relating fields at \( z = 0 \), with \( \rho_{ij} \) and \( \tau_{ij} \) for the Fresnel reflection and transmission coefficients, we have

\begin{dmath}\label{eqn:emtproblemSet8Problem3:200}
\begin{aligned}
A &= C \tau_{ji} + B \rho_{ij} \\
D &= B \tau_{ij} + C \rho_{ji}.
\end{aligned}
\end{dmath}

To express the boundary conditions for the fields at \( z = d_j \), let

\begin{dmath}\label{eqn:emtproblemSet8Problem3:220}
\gamma = e^{ j \beta_j d_j } .
\end{dmath}

Those boundary conditions are
\begin{dmath}\label{eqn:emtproblemSet8Problem3:240}
\begin{aligned}
C \gamma &= E \tau_{i+1, j} + \frac{D}{\gamma} \rho_{j,i+1} \\
F &= E \rho_{i+1,j} + \frac{D}{\gamma} \tau_{j,i+1}.
\end{aligned}
\end{dmath}

The periodicity constraint is 

\begin{dmath}\label{eqn:emtproblemSet8Problem3:260}
\begin{aligned}
d_{i+1} &= d_i \\
d_{j+1} &= d_j \\
\beta_{i+1} &= \beta_i \\
\beta_{j+1} &= \beta_j,
\end{aligned}
\end{dmath}

so we have

\begin{dmath}\label{eqn:emtproblemSet8Problem3:280}
\begin{aligned}
\begin{bmatrix}
1 & - \rho_{ij} \\
0 &   \tau_{ij} 
\end{bmatrix}
\begin{bmatrix}
A \\
B
\end{bmatrix}
&=
\begin{bmatrix}
  \tau_{ji} & 0 \\
- \rho_{ji} & 1
\end{bmatrix}
\begin{bmatrix}
C \\
D
\end{bmatrix} \\
\begin{bmatrix}
  \gamma^2 &- \rho_{j i} \\
  0        &  \tau_{j i} 
\end{bmatrix}
\begin{bmatrix}
C \\
D
\end{bmatrix}
&=
\gamma
\begin{bmatrix}
     \tau_{i j} & 0 \\
 -   \rho_{i j} & 1 
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
\end{aligned}
\end{dmath}

This gives
\begin{dmath}\label{eqn:emtproblemSet8Problem3:300}
\begin{bmatrix}
A \\
B
\end{bmatrix}
=
\gamma
{\begin{bmatrix}
1 & - \rho_{ij} \\
0 &   \tau_{ij} 
\end{bmatrix}}^{-1}
\begin{bmatrix}
  \tau_{ji} & 0 \\
- \rho_{ji} & 1
\end{bmatrix}
{\begin{bmatrix}
  \gamma^2 &- \rho_{j i} \\
  0        &  \tau_{j i} 
\end{bmatrix}}^{-1}
\begin{bmatrix}
     \tau_{i j} & 0 \\
 -   \rho_{i j} & 1 
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
=
\frac{1}{\gamma \tau_{ij} \tau_{ji}}
\begin{bmatrix}
\tau_{ij} & \rho_{ij} \\
0 &   1
\end{bmatrix}
\begin{bmatrix}
  \tau_{ji} & 0 \\
- \rho_{ji} & 1
\end{bmatrix}
\begin{bmatrix}
    \tau_{ji} &  \rho_{j i} \\
  0        &  \gamma^2
\end{bmatrix}
\begin{bmatrix}
     \tau_{i j} & 0 \\
 -   \rho_{i j} & 1 
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
=
\frac{1}{\gamma \tau_{ij} \tau_{ji}}
\begin{bmatrix}
\tau_{ij}\tau_{ji} - \rho_{ij} \rho_{ji} &  \rho_{ij} \\
-\rho_{ji}                      &  1 
\end{bmatrix}
\begin{bmatrix}
\tau_{ji} \tau_{i j} - \rho_{ij} \rho_{ji} & \rho_{j i} \\
-\gamma^2 \rho_{ij}               & \gamma^2
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
=
\frac{1}{\gamma \tau_{ij} \tau_{ji}}
\begin{bmatrix}
\tau_{ij}\tau_{ji} + \rho_{ij}^2 &  \rho_{ij} \\
\rho_{ij}                  &  1 
\end{bmatrix}
\begin{bmatrix}
\tau_{ji} \tau_{i j} + \rho_{ij}^2 & -\rho_{i j} \\
-\gamma^2 \rho_{ij}          & \gamma^2
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
\end{dmath}

A digression is now required, since the problem asks for this matrix in terms of the reflection coefficients, and we have both the reflection coefficients and transmission coefficients in the mix.  For TE we have

\begin{dmath}\label{eqn:emtproblemSet8Problem3:320}
\begin{aligned}
\rho_{12} &= 
\frac
{\mu_2 \beta_1 - \mu_1 \beta_2}
{\mu_2 \beta_1 + \mu_1 \beta_2} \\
\rho_{21} &= -\rho_{12} \\
\tau_{12} &= 2 \frac
{\mu_2 \beta_1}
{\mu_2 \beta_1 + \mu_1 \beta_2} \\
\tau_{21} &= 2 \frac
{\mu_1 \beta_2}
{\mu_2 \beta_1 + \mu_1 \beta_2} \\
\end{aligned}.
\end{dmath}

Rearranging for \( \tau_{12} \) and \( \tau_{21} \) gives

\begin{dmath}\label{eqn:emtproblemSet8Problem3:340}
\begin{aligned}
2 \rho_{12} &= \tau_{12} - \tau_{21} \\
2        &= \tau_{12} + \tau_{21},
\end{aligned}
\end{dmath}

or
\begin{dmath}\label{eqn:emtproblemSet8Problem3:360}
\begin{aligned}
\tau_{12} &= 1 + \rho_{12} \\
\tau_{21} &= 1 - \rho_{12}.
\end{aligned}
\end{dmath}

In particular, we have
\begin{dmath}\label{eqn:emtproblemSet8Problem3:380}
\tau_{12} \tau_{21} = 1 - \rho_{12}^2.
\end{dmath}

Does this relation also hold for TM modes?  In problem 1 for TM, we found

\begin{dmath}\label{eqn:emtproblemSet8Problem3:400}
\begin{aligned}
\rho_{12} &= 
\frac
{\epsilon_1 \beta_2 - \epsilon_2 \beta_1}
{\epsilon_2 \beta_1 + \epsilon_1 \beta_2} \\
\rho_{21} &= -\rho_{12} \\
\tau_{12} &= 
2 \frac{\eta_2}{\eta_1} \frac
{\epsilon_2 \beta_1}
{\epsilon_2 \beta_1 + \epsilon_1 \beta_2} \\
\tau_{21} &= 
2 \frac{\eta_1}{\eta_2} \frac
{\epsilon_1 \beta_2}
{\epsilon_2 \beta_1 + \epsilon_1 \beta_2} \\
\end{aligned}.
\end{dmath}

Rearranging for \( \tau_{12} \) and \( \tau_{21} \) gives

\begin{dmath}\label{eqn:emtproblemSet8Problem3:420}
\begin{aligned}
2 \rho_{12} &= -\tau_{12} \frac{\eta_1}{\eta_2} + \tau_{21}\frac{\eta_2}{\eta_1}  \\
2        &= \tau_{12} \frac{\eta_1}{\eta_2} + \tau_{21}\frac{\eta_2}{\eta_1} ,
\end{aligned}
\end{dmath}

or

\begin{dmath}\label{eqn:emtproblemSet8Problem3:440}
\begin{aligned}
\tau_{21}\frac{\eta_2}{\eta_1} &= 1 + \rho_{12} \\
\tau_{12} \frac{\eta_1}{\eta_2} &= 1 - \rho_{12},
\end{aligned}
\end{dmath}

so we also find 
\begin{dmath}\label{eqn:emtproblemSet8Problem3:460}
\tau_{12} \tau_{21} = 1 - \rho_{12}^2.
\end{dmath}

Inserting this into \cref{eqn:emtproblemSet8Problem3:300}, we have

\begin{dmath}\label{eqn:emtproblemSet8Problem3:480}
\begin{bmatrix}
E'_{l,i} \\
E'_{r,i} \\
\end{bmatrix}
=
\begin{bmatrix}
A \\
B
\end{bmatrix}
=
\frac{1}{\gamma (1 - \rho_{12}^2)}
\begin{bmatrix}
1                       &  \rho_{ij} \\
\rho_{ij}                  &  1 
\end{bmatrix}
\begin{bmatrix}
1                       & -\rho_{i j} \\
-\gamma^2 \rho_{ij}        & \gamma^2
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
=
\frac{1}{\gamma (1 - \rho_{12}^2)}
\begin{bmatrix}
1 - \gamma^2 \rho_{ij}^2 & - \rho_{ij}( 1 - \gamma^2 ) \\
\rho_{ij}( 1 - \gamma^2 ) & \gamma^2 - \rho_{ij}^2
\end{bmatrix}
\begin{bmatrix}
E \\
F
\end{bmatrix}
\end{dmath}

Since 
\begin{dmath}\label{eqn:emtproblemSet8Problem3:500}
\begin{bmatrix}
E \\
F
\end{bmatrix}
=
\begin{bmatrix}
E'_{l,i+1}/\gamma' \\
E'_{r,i+1} \gamma'
\end{bmatrix}
=
\begin{bmatrix}
1/\gamma' & 0 \\
0         & \gamma'
\end{bmatrix}
\begin{bmatrix}
E'_{l,i+1} \\
E'_{r,i+1} 
\end{bmatrix},
\end{dmath}

so
\begin{dmath}\label{eqn:emtproblemSet8Problem3:520}
\begin{bmatrix}
E'_{l,i} \\
E'_{r,i} \\
\end{bmatrix}
=
\frac{1}{\gamma (1 - \rho_{12}^2)}
\begin{bmatrix}
1 - \gamma^2 \rho_{ij}^2 & - \rho_{ij}( 1 - \gamma^2 ) \\
\rho_{ij}( 1 - \gamma^2 ) & \gamma^2 - \rho_{ij}^2
\end{bmatrix}
\begin{bmatrix}
1/\gamma' & 0 \\
0         & \gamma'
\end{bmatrix}
\begin{bmatrix}
E'_{l,i+1} \\
E'_{r,i+1} 
\end{bmatrix}
=
\frac{1}{\gamma (1 - \rho_{12}^2)}
\begin{bmatrix}
(1 - \gamma^2 \rho_{ij}^2)/\gamma' & - \rho_{ij}( 1 - \gamma^2 ) \gamma' \\
\rho_{ij}( 1 - \gamma^2 )/\gamma' & (\gamma^2 - \rho_{ij}^2) \gamma'
\end{bmatrix}
\begin{bmatrix}
E'_{l,i+1} \\
E'_{r,i+1} 
\end{bmatrix}
\end{dmath}

With the leading coeffient including a \( g = 1/(1 - \rho_{ij}^2) \) factor, the desired matrix elements can be read off

\begin{dmath}\label{eqn:emtproblemSet8Problem3:540}
\begin{aligned}
a &= \inv{\gamma \gamma'} (1 - \gamma^2 \rho_{ij}^2) \\
\hat{a} &= (\gamma^2 - \rho_{ij}^2) \frac{\gamma'}{\gamma} \\
b &= - \rho_{ij}( 1 - \gamma^2 ) \frac{\gamma'}{\gamma} \\
\hat{b} &= \inv{\gamma \gamma'} \rho_{ij}( 1 - \gamma^2 ).
\end{aligned}
\end{dmath}

With \( \gamma = e^{-j \phi_j } = e^{j \beta_j d_j}, \gamma' = e^{-j\phi_i} = e^{j \beta_i d_i} \), these are

\begin{dmath}\label{eqn:emtproblemSet8Problem3:660}
\begin{aligned}
a &= e^{j(\phi_j + \phi_i)} (1 - e^{-2j \phi_j} \rho_{ij}^2) \\
\hat{a} &= (e^{-2j \phi_j} - \rho_{ij}^2) e^{j(\phi_j - \phi_i)} \\
b &= - \rho_{ij}( 1 - e^{-2 j\phi_j} ) e^{j(\phi_j - \phi_i)} \\
\hat{b} &= e^{j(\phi_j + \phi_i)} \rho_{ij}( 1 - e^{-2 j \phi_j} ),
\end{aligned}
\end{dmath}

or

\boxedEquation{eqn:emtproblemSet8Problem3:640}{
\begin{aligned}
a &= 
(e^{j \phi_j} - e^{-j \phi_j} \rho_{ij}^2) 
e^{ j\phi_i } 
\\
\hat{a} &= (e^{-j \phi_j} - e^{j \phi_j} \rho_{ij}^2) e^{-j \phi_i} \\
b &= - \rho_{ij}( e^{j \phi_j} - e^{- j\phi_j} ) e^{-j\phi_i} \\
\hat{b} &= 
\rho_{ij}( e^{j\phi_j} - e^{- j \phi_j} )
e^{j\phi_i} 
,
\end{aligned}
}

The complete transfer matrix is
\begin{dmath}\label{eqn:emtproblemSet8Problem3:680}
\BM
=
\inv{1 - \rho_{i,j}^2}
\begin{bmatrix}
(e^{j \phi_j} - e^{-j \phi_j} \rho_{ij}^2) 
e^{ j\phi_i } 
& - \rho_{ij}( e^{j \phi_j} - e^{- j\phi_j} ) e^{-j\phi_i} \\
\rho_{ij}( e^{j\phi_j} - e^{- j \phi_j} ) e^{j\phi_i} &
(e^{-j \phi_j} - e^{j \phi_j} \rho_{ij}^2) e^{-j \phi_i} \\
\end{bmatrix}
\end{dmath}


%%\begin{dmath}\label{eqn:emtproblemSet8Problem3:560}
%\boxedEquation{eqn:emtproblemSet8Problem3:560}{
%\begin{aligned}
%a &= e^{-j(\beta_i d_i + \beta_j d_j)} \lr{ 1 - e^{2 j \beta_j d_j} \rho_{ij}^2 } \\
%\hat{a} &= \lr{e^{2 j \beta_j d_j} - \rho_{ij}^2 } e^{j (\beta_i d_i - \beta_j d_j)} \\
%b &= - \rho_{ij}\lr{ 1 - e^{2 j \beta_j d_j} } e^{j (\beta_i d_i - \beta_j d_j)} \\
%\hat{b} &= e^{-j(\beta_i d_i + \beta_j d_j)} \rho_{ij} \lr{ 1 - e^{2 j \beta_j d_j} }
%\end{aligned}
%}
%%\end{dmath}

%%%The \( a,b \) and \( \hat{a}, \hat{b} \) differ from each other by phase factors.  Factoring those out we have
%%%
%%%\begin{dmath}\label{eqn:emtproblemSet8Problem3:580}
%%%\hat{a} 
%%%= e^{2 j \beta_j d_j} \lr{1 - e^{-2 j \beta_j d_j} \rho_{ij}^2 } e^{j (\beta_i d_i - \beta_j d_j)} 
%%%= \lr{1 - e^{-2 j \beta_j d_j} \rho_{ij}^2 } e^{j (\beta_i d_i - 3 \beta_j d_j)} 
%%%= e^{-j(\beta_i d_i + \beta_j d_j)} \lr{1 - e^{-2 j \beta_j d_j} \rho_{ij}^2 } e^{2 j (\beta_i d_i - \beta_j d_j)} 
%%%= e^{2 j (\beta_i d_i - \beta_j d_j)} a,
%%%\end{dmath}
%%%
%%%and
%%%
%%%\begin{dmath}\label{eqn:emtproblemSet8Problem3:600}
%%%\hat{b} 
%%%= e^{-j(\beta_i d_i + \beta_j d_j)} \rho_{ij} \lr{ 1 - e^{2 j \beta_j d_j} }
%%%= e^{-2 j(\beta_i d_i) } e^{j(\beta_i d_i - \beta_j d_j)} \rho_{ij} \lr{ 1 - e^{2 j \beta_j d_j} }
%%%= -e^{-2 j(\beta_i d_i) } b,
%%%\end{dmath}
%%%
%%%\boxedEquation{eqn:emtproblemSet8Problem3:620}{
%%%\begin{aligned}
%%%a &= e^{-j(\beta_i d_i + \beta_j d_j)} \lr{ 1 - e^{2 j \beta_j d_j} \rho_{ij}^2 } \\
%%%b &= - \rho_{ij}\lr{ 1 - e^{2 j \beta_j d_j} } e^{j (\beta_i d_i - \beta_j d_j)} \\-e^{-2 j(\beta_i d_i) } b \\
%%%\hat{a} &= e^{2 j (\beta_i d_i - \beta_j d_j)} a \\
%%%\hat{b} &= -e^{-2 j(\beta_i d_i) } b \\
%%%\end{aligned}
%%%}

}
